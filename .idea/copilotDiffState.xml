<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/IMAGE_403_FIX.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/IMAGE_403_FIX.md" />
              <option name="updatedContent" value="# Correction - Accès aux Images (403 Forbidden)&#10;&#10;##  Problème rencontré&#10;&#10;Lors de l'affichage des images de profil, l'erreur suivante apparaissait :&#10;```&#10;GET http://localhost:8080/AUTH-SERVICE/files/bd5af066-ae35-44d4-9e7c-2f437ba4d814.png 403 (Forbidden)&#10;```&#10;&#10;### Cause&#10;Les images étaient stockées correctement dans la base de données et sur le disque, mais l'endpoint `/files/**` nécessitait une authentification JWT. Les balises `&lt;img&gt;` HTML ne peuvent pas envoyer de headers d'authentification, donc l'accès était refusé.&#10;&#10;---&#10;&#10;## ✅ Solution appliquée&#10;&#10;### 1. Modification de SecurityConfig.java&#10;&#10;**Fichier modifié :**&#10;```&#10;auth-service/src/main/java/com/aitsaid/authservice/config/SecurityConfig.java&#10;```&#10;&#10;**Changement :**&#10;Ajout de `.requestMatchers(&quot;/files/**&quot;).permitAll()` pour permettre l'accès public aux fichiers uploadés.&#10;&#10;```java&#10;@Bean&#10;public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {&#10;    http&#10;            .csrf(AbstractHttpConfigurer::disable)&#10;            .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))&#10;            .authorizeHttpRequests(auth -&gt; auth&#10;                    .requestMatchers(&quot;/auth/login&quot;, &quot;/auth/register&quot;).permitAll()&#10;                    .requestMatchers(&quot;/files/**&quot;).permitAll() // ✅ AJOUTÉ&#10;                    .requestMatchers(&quot;/auth/validate-token&quot;).authenticated()&#10;                    .requestMatchers(&quot;/auth/logout&quot;).authenticated()&#10;                    .requestMatchers(&quot;/admin/**&quot;).hasAuthority(String.valueOf(Role.ROLE_ADMIN))&#10;                    .anyRequest().authenticated())&#10;            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);&#10;&#10;    return http.build();&#10;}&#10;```&#10;&#10;---&#10;&#10;##  Sécurité&#10;&#10;### Cette modification est-elle sécurisée ?&#10;&#10;**✅ OUI**, pour les raisons suivantes :&#10;&#10;1. **Les images sont publiques par nature** - Les photos de profil sont destinées à être affichées publiquement dans l'interface&#10;2. **Noms de fichiers UUID** - Les fichiers utilisent des noms UUID impossibles à deviner (ex: `bd5af066-ae35-44d4-9e7c-2f437ba4d814.png`)&#10;3. **Pas d'énumération possible** - Impossible de lister les fichiers du répertoire&#10;4. **L'upload reste protégé** - Seuls les admins authentifiés peuvent uploader des fichiers via `/admin/users/{userId}/profile-image`&#10;5. **Pas de données sensibles** - Les images de profil ne contiennent pas d'informations confidentielles&#10;&#10;### Endpoints protégés vs publics&#10;&#10;| Endpoint | Accès | Raison |&#10;|----------|-------|--------|&#10;| `POST /files/upload` | ✅ Protégé (Authentifié) | Upload nécessite auth |&#10;| `POST /admin/users/{userId}/profile-image` | ✅ Protégé (Admin) | Modification utilisateur |&#10;| `GET /files/{fileName}` | ⚠️ Public | Affichage des images |&#10;| `DELETE /files/{fileName}` | ✅ Protégé (Authentifié) | Suppression nécessite auth |&#10;&#10;---&#10;&#10;##  Test de la correction&#10;&#10;### 1. Redémarrer le backend&#10;```bash&#10;cd auth-service&#10;mvn clean spring-boot:run&#10;```&#10;&#10;### 2. Tester l'accès à une image&#10;&#10;**Sans authentification (devrait fonctionner) :**&#10;```bash&#10;curl http://localhost:8080/AUTH-SERVICE/files/bd5af066-ae35-44d4-9e7c-2f437ba4d814.png&#10;```&#10;&#10;**Ou dans le navigateur :**&#10;```&#10;http://localhost:8080/AUTH-SERVICE/files/bd5af066-ae35-44d4-9e7c-2f437ba4d814.png&#10;```&#10;&#10;**Résultat attendu :** ✅ L'image s'affiche (status 200)&#10;&#10;### 3. Vérifier dans l'application Angular&#10;&#10;1. Aller sur http://localhost:4200/admin/users&#10;2. Les avatars des utilisateurs devraient maintenant s'afficher correctement&#10;3. Aucune erreur 403 dans la console&#10;&#10;---&#10;&#10;##  Comparaison Avant/Après&#10;&#10;### Avant ❌&#10;```&#10;&lt;img src=&quot;http://localhost:8080/AUTH-SERVICE/files/image.png&quot;&gt;&#10;↓&#10;403 Forbidden (authentification requise)&#10;↓&#10;Image non affichée ❌&#10;```&#10;&#10;### Après ✅&#10;```&#10;&lt;img src=&quot;http://localhost:8080/AUTH-SERVICE/files/image.png&quot;&gt;&#10;↓&#10;200 OK (accès public autorisé)&#10;↓&#10;Image affichée ✅&#10;```&#10;&#10;---&#10;&#10;## ️ Bonnes pratiques de sécurité appliquées&#10;&#10;1. ✅ **Noms de fichiers imprévisibles** (UUID)&#10;2. ✅ **Validation des types de fichiers** à l'upload&#10;3. ✅ **Limite de taille** des fichiers&#10;4. ✅ **Upload protégé** par authentification admin&#10;5. ✅ **Pas de listing de répertoire** possible&#10;6. ✅ **Séparation des permissions** (lecture publique, écriture protégée)&#10;&#10;---&#10;&#10;##  Notes pour la production&#10;&#10;### Recommandations&#10;&#10;1. **Utiliser un CDN** pour servir les images :&#10;   - Amazon CloudFront + S3&#10;   - Azure CDN + Blob Storage&#10;   - Cloudflare&#10;&#10;2. **Ajouter un cache HTTP** :&#10;   ```java&#10;   @GetMapping(&quot;/{fileName:.+}&quot;)&#10;   public ResponseEntity&lt;Resource&gt; downloadFile(@PathVariable String fileName) {&#10;       // ... code existant ...&#10;       return ResponseEntity.ok()&#10;               .cacheControl(CacheControl.maxAge(30, TimeUnit.DAYS))&#10;               .contentType(MediaType.parseMediaType(contentType))&#10;               .body(resource);&#10;   }&#10;   ```&#10;&#10;3. **Implémenter un système de permissions** si nécessaire :&#10;   - Images privées pour certains utilisateurs&#10;   - Vérification de token optionnelle&#10;&#10;4. **Monitoring** :&#10;   - Logger les accès aux fichiers&#10;   - Détecter les tentatives d'accès suspects&#10;&#10;---&#10;&#10;##  Résumé&#10;&#10;### Problème&#10;Images stockées mais erreur 403 lors de l'affichage car endpoint protégé par authentification JWT.&#10;&#10;### Solution&#10;Autoriser l'accès public à `/files/**` dans SecurityConfig pour permettre l'affichage des images via balises `&lt;img&gt;`.&#10;&#10;### Impact&#10;- ✅ Images de profil maintenant visibles&#10;- ✅ Sécurité maintenue (upload toujours protégé)&#10;- ✅ UUIDs empêchent la devinette des noms de fichiers&#10;- ✅ Pas d'impact sur les autres endpoints&#10;&#10;### Fichiers modifiés&#10;1. `SecurityConfig.java` - Ajout de `.requestMatchers(&quot;/files/**&quot;).permitAll()`&#10;&#10;---&#10;&#10;## ✨ Résultat&#10;&#10;Les images de profil s'affichent maintenant correctement dans l'application ! &#10;&#10;**Avant :**  Images bloquées (403)  &#10;**Après :** ✅ Images affichées correctement&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/IMAGE_UPLOAD_API_DOCUMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/IMAGE_UPLOAD_API_DOCUMENTATION.md" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="# API Documentation - Upload d'Images&#10;&#10;## Base URL&#10;```&#10;http://localhost:8080/AUTH-SERVICE&#10;```&#10;&#10;## Authentification&#10;Tous les endpoints nécessitent un token JWT valide dans le header `Authorization` :&#10;```&#10;Authorization: Bearer &lt;token&gt;&#10;```&#10;&#10;---&#10;&#10;##  Upload de fichiers&#10;&#10;### 1. Upload d'un fichier générique&#10;&#10;**Endpoint:** `POST /files/upload`&#10;&#10;**Description:** Upload un fichier et retourne ses informations.&#10;&#10;**Headers:**&#10;```http&#10;Authorization: Bearer &lt;token&gt;&#10;Content-Type: multipart/form-data&#10;```&#10;&#10;**Body (form-data):**&#10;```&#10;file: [fichier à uploader]&#10;```&#10;&#10;**Exemple de requête (cURL):**&#10;```bash&#10;curl -X POST http://localhost:8080/AUTH-SERVICE/files/upload \&#10;  -H &quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot; \&#10;  -F &quot;file=@/path/to/image.jpg&quot;&#10;```&#10;&#10;**Réponse (200 OK):**&#10;```json&#10;{&#10;  &quot;fileName&quot;: &quot;550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;fileUrl&quot;: &quot;/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;fileType&quot;: &quot;image/jpeg&quot;,&#10;  &quot;size&quot;: &quot;45678&quot;&#10;}&#10;```&#10;&#10;---&#10;&#10;### 2. Upload d'image de profil utilisateur&#10;&#10;**Endpoint:** `POST /admin/users/{userId}/profile-image`&#10;&#10;**Description:** Upload une image de profil pour un utilisateur spécifique et met à jour son profil.&#10;&#10;**Headers:**&#10;```http&#10;Authorization: Bearer &lt;token&gt;&#10;Content-Type: multipart/form-data&#10;```&#10;&#10;**Path Parameters:**&#10;```&#10;userId (Long): ID de l'utilisateur&#10;```&#10;&#10;**Body (form-data):**&#10;```&#10;file: [fichier image à uploader]&#10;```&#10;&#10;**Exemple de requête (cURL):**&#10;```bash&#10;curl -X POST http://localhost:8080/AUTH-SERVICE/admin/users/1/profile-image \&#10;  -H &quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot; \&#10;  -F &quot;file=@/path/to/profile.jpg&quot;&#10;```&#10;&#10;**Réponse (200 OK):**&#10;```json&#10;{&#10;  &quot;id&quot;: 1,&#10;  &quot;firstName&quot;: &quot;John&quot;,&#10;  &quot;lastName&quot;: &quot;Doe&quot;,&#10;  &quot;email&quot;: &quot;john.doe@example.com&quot;,&#10;  &quot;cin&quot;: &quot;AB123456&quot;,&#10;  &quot;phoneNumber&quot;: &quot;0612345678&quot;,&#10;  &quot;address&quot;: &quot;123 Main St&quot;,&#10;  &quot;profileImage&quot;: &quot;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;role&quot;: &quot;ROLE_USER&quot;,&#10;  &quot;enabled&quot;: true,&#10;  &quot;createdAt&quot;: &quot;2024-12-01T10:30:00&quot;&#10;}&#10;```&#10;&#10;**Codes d'erreur:**&#10;- `400 Bad Request` - Fichier invalide ou manquant&#10;- `404 Not Found` - Utilisateur non trouvé&#10;- `500 Internal Server Error` - Erreur lors du stockage&#10;&#10;---&#10;&#10;##  Récupération de fichiers&#10;&#10;### 3. Récupérer un fichier&#10;&#10;**Endpoint:** `GET /files/{fileName}`&#10;&#10;**Description:** Récupère un fichier précédemment uploadé.&#10;&#10;**⚠️ Note:** Cet endpoint est **accessible publiquement** (pas d'authentification requise) pour permettre l'affichage des images dans les balises `&lt;img&gt;` HTML.&#10;&#10;**Headers:**&#10;```http&#10;Aucun header requis (accès public)&#10;```&#10;&#10;**Path Parameters:**&#10;```&#10;fileName (String): Nom du fichier (avec extension)&#10;```&#10;&#10;**Exemple de requête:**&#10;```&#10;GET http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&#10;```&#10;&#10;**Réponse (200 OK):**&#10;- Content-Type: `image/jpeg`, `image/png`, ou `image/gif`&#10;- Body: Contenu binaire de l'image&#10;&#10;**Utilisation dans HTML:**&#10;```html&#10;&lt;img src=&quot;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot; &#10;     alt=&quot;Profile Image&quot; /&gt;&#10;```&#10;&#10;**Codes d'erreur:**&#10;- `404 Not Found` - Fichier non trouvé&#10;&#10;---&#10;&#10;## ️ Suppression de fichiers&#10;&#10;### 4. Supprimer un fichier&#10;&#10;**Endpoint:** `DELETE /files/{fileName}`&#10;&#10;**Description:** Supprime un fichier du système.&#10;&#10;**Headers:**&#10;```http&#10;Authorization: Bearer &lt;token&gt;&#10;```&#10;&#10;**Path Parameters:**&#10;```&#10;fileName (String): Nom du fichier à supprimer&#10;```&#10;&#10;**Exemple de requête (cURL):**&#10;```bash&#10;curl -X DELETE http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg \&#10;  -H &quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;&#10;```&#10;&#10;**Réponse (200 OK):**&#10;```json&#10;{&#10;  &quot;message&quot;: &quot;Fichier supprimé avec succès&quot;&#10;}&#10;```&#10;&#10;**Codes d'erreur:**&#10;- `404 Not Found` - Fichier non trouvé&#10;&#10;---&#10;&#10;##  Gestion des utilisateurs (avec images)&#10;&#10;### 5. Obtenir tous les utilisateurs&#10;&#10;**Endpoint:** `GET /admin/users`&#10;&#10;**Description:** Retourne la liste de tous les utilisateurs avec leurs images de profil.&#10;&#10;**Exemple de réponse:**&#10;```json&#10;[&#10;  {&#10;    &quot;id&quot;: 1,&#10;    &quot;firstName&quot;: &quot;John&quot;,&#10;    &quot;lastName&quot;: &quot;Doe&quot;,&#10;    &quot;email&quot;: &quot;john.doe@example.com&quot;,&#10;    &quot;profileImage&quot;: &quot;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;    &quot;enabled&quot;: true,&#10;    &quot;createdAt&quot;: &quot;2024-12-01T10:30:00&quot;&#10;  },&#10;  {&#10;    &quot;id&quot;: 2,&#10;    &quot;firstName&quot;: &quot;Jane&quot;,&#10;    &quot;lastName&quot;: &quot;Smith&quot;,&#10;    &quot;email&quot;: &quot;jane.smith@example.com&quot;,&#10;    &quot;profileImage&quot;: null,&#10;    &quot;enabled&quot;: true,&#10;    &quot;createdAt&quot;: &quot;2024-12-01T11:00:00&quot;&#10;  }&#10;]&#10;```&#10;&#10;---&#10;&#10;### 6. Obtenir un utilisateur par ID&#10;&#10;**Endpoint:** `GET /admin/users/{userId}`&#10;&#10;**Description:** Retourne les détails d'un utilisateur spécifique.&#10;&#10;**Exemple de réponse:**&#10;```json&#10;{&#10;  &quot;id&quot;: 1,&#10;  &quot;firstName&quot;: &quot;John&quot;,&#10;  &quot;lastName&quot;: &quot;Doe&quot;,&#10;  &quot;email&quot;: &quot;john.doe@example.com&quot;,&#10;  &quot;cin&quot;: &quot;AB123456&quot;,&#10;  &quot;phoneNumber&quot;: &quot;0612345678&quot;,&#10;  &quot;address&quot;: &quot;123 Main St&quot;,&#10;  &quot;profileImage&quot;: &quot;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;role&quot;: &quot;ROLE_USER&quot;,&#10;  &quot;enabled&quot;: true,&#10;  &quot;createdAt&quot;: &quot;2024-12-01T10:30:00&quot;&#10;}&#10;```&#10;&#10;---&#10;&#10;### 7. Créer un utilisateur&#10;&#10;**Endpoint:** `POST /admin/users`&#10;&#10;**Description:** Crée un nouvel utilisateur (sans image, l'image doit être uploadée séparément).&#10;&#10;**Body:**&#10;```json&#10;{&#10;  &quot;firstName&quot;: &quot;John&quot;,&#10;  &quot;lastName&quot;: &quot;Doe&quot;,&#10;  &quot;email&quot;: &quot;john.doe@example.com&quot;,&#10;  &quot;password&quot;: &quot;securePassword123&quot;,&#10;  &quot;cin&quot;: &quot;AB123456&quot;,&#10;  &quot;phoneNumber&quot;: &quot;0612345678&quot;,&#10;  &quot;address&quot;: &quot;123 Main St&quot;,&#10;  &quot;role&quot;: &quot;ROLE_USER&quot;&#10;}&#10;```&#10;&#10;**Workflow pour créer un utilisateur avec image:**&#10;1. Créer l'utilisateur avec `POST /admin/users` → Récupérer l'ID&#10;2. Uploader l'image avec `POST /admin/users/{userId}/profile-image`&#10;&#10;---&#10;&#10;### 8. Mettre à jour un utilisateur&#10;&#10;**Endpoint:** `PATCH /admin/users/{userId}`&#10;&#10;**Description:** Met à jour les informations d'un utilisateur.&#10;&#10;**Body:**&#10;```json&#10;{&#10;  &quot;firstName&quot;: &quot;John&quot;,&#10;  &quot;lastName&quot;: &quot;Doe&quot;,&#10;  &quot;email&quot;: &quot;john.doe@example.com&quot;,&#10;  &quot;cin&quot;: &quot;AB123456&quot;,&#10;  &quot;phoneNumber&quot;: &quot;0612345678&quot;,&#10;  &quot;address&quot;: &quot;123 Main St&quot;,&#10;  &quot;role&quot;: &quot;ROLE_USER&quot;&#10;}&#10;```&#10;&#10;**Note:** Pour mettre à jour l'image, utilisez l'endpoint dédié `/admin/users/{userId}/profile-image`&#10;&#10;---&#10;&#10;##  Contraintes et limites&#10;&#10;### Taille des fichiers&#10;- **Frontend**: Maximum 5 MB&#10;- **Backend**: Maximum 10 MB (configurable dans `application.yml`)&#10;&#10;### Types de fichiers acceptés&#10;- `image/jpeg` (.jpg, .jpeg)&#10;- `image/png` (.png)&#10;- `image/gif` (.gif)&#10;&#10;### Nommage des fichiers&#10;Les fichiers sont automatiquement renommés avec un UUID unique pour éviter les conflits :&#10;```&#10;Original: &quot;photo_profil.jpg&quot;&#10;Stocké comme: &quot;550e8400-e29b-41d4-a716-446655440000.jpg&quot;&#10;```&#10;&#10;---&#10;&#10;##  Sécurité&#10;&#10;### Endpoints protégés vs publics&#10;&#10;| Endpoint | Accès | Raison |&#10;|----------|-------|--------|&#10;| `POST /files/upload` | ✅ Authentifié | Upload nécessite auth |&#10;| `POST /admin/users/{userId}/profile-image` | ✅ Admin | Modification utilisateur |&#10;| `GET /files/{fileName}` |  **Public** | Affichage des images dans HTML |&#10;| `DELETE /files/{fileName}` | ✅ Authentifié | Suppression nécessite auth |&#10;&#10;**Note importante:** L'accès public à `GET /files/{fileName}` est sécurisé car :&#10;- Les noms de fichiers sont des UUID impossibles à deviner&#10;- Impossible de lister les fichiers du répertoire&#10;- L'upload reste protégé par authentification&#10;- Les images de profil sont destinées à être publiques&#10;&#10;### Validation&#10;- Vérification du type MIME des fichiers&#10;- Limite de taille stricte&#10;- Validation des noms de fichiers (pas de caractères dangereux)&#10;- UUID unique pour chaque fichier&#10;&#10;---&#10;&#10;##  Tests avec Postman&#10;&#10;### Collection Postman&#10;&#10;```json&#10;{&#10;  &quot;info&quot;: {&#10;    &quot;name&quot;: &quot;Image Upload API&quot;,&#10;    &quot;schema&quot;: &quot;https://schema.getpostman.com/json/collection/v2.1.0/collection.json&quot;&#10;  },&#10;  &quot;item&quot;: [&#10;    {&#10;      &quot;name&quot;: &quot;Upload File&quot;,&#10;      &quot;request&quot;: {&#10;        &quot;method&quot;: &quot;POST&quot;,&#10;        &quot;header&quot;: [&#10;          {&#10;            &quot;key&quot;: &quot;Authorization&quot;,&#10;            &quot;value&quot;: &quot;Bearer {{token}}&quot;&#10;          }&#10;        ],&#10;        &quot;body&quot;: {&#10;          &quot;mode&quot;: &quot;formdata&quot;,&#10;          &quot;formdata&quot;: [&#10;            {&#10;              &quot;key&quot;: &quot;file&quot;,&#10;              &quot;type&quot;: &quot;file&quot;,&#10;              &quot;src&quot;: &quot;/path/to/image.jpg&quot;&#10;            }&#10;          ]&#10;        },&#10;        &quot;url&quot;: {&#10;          &quot;raw&quot;: &quot;{{baseUrl}}/files/upload&quot;,&#10;          &quot;host&quot;: [&quot;{{baseUrl}}&quot;],&#10;          &quot;path&quot;: [&quot;files&quot;, &quot;upload&quot;]&#10;        }&#10;      }&#10;    },&#10;    {&#10;      &quot;name&quot;: &quot;Upload User Profile Image&quot;,&#10;      &quot;request&quot;: {&#10;        &quot;method&quot;: &quot;POST&quot;,&#10;        &quot;header&quot;: [&#10;          {&#10;            &quot;key&quot;: &quot;Authorization&quot;,&#10;            &quot;value&quot;: &quot;Bearer {{token}}&quot;&#10;          }&#10;        ],&#10;        &quot;body&quot;: {&#10;          &quot;mode&quot;: &quot;formdata&quot;,&#10;          &quot;formdata&quot;: [&#10;            {&#10;              &quot;key&quot;: &quot;file&quot;,&#10;              &quot;type&quot;: &quot;file&quot;,&#10;              &quot;src&quot;: &quot;/path/to/profile.jpg&quot;&#10;            }&#10;          ]&#10;        },&#10;        &quot;url&quot;: {&#10;          &quot;raw&quot;: &quot;{{baseUrl}}/admin/users/:userId/profile-image&quot;,&#10;          &quot;host&quot;: [&quot;{{baseUrl}}&quot;],&#10;          &quot;path&quot;: [&quot;admin&quot;, &quot;users&quot;, &quot;:userId&quot;, &quot;profile-image&quot;],&#10;          &quot;variable&quot;: [&#10;            {&#10;              &quot;key&quot;: &quot;userId&quot;,&#10;              &quot;value&quot;: &quot;1&quot;&#10;            }&#10;          ]&#10;        }&#10;      }&#10;    }&#10;  ],&#10;  &quot;variable&quot;: [&#10;    {&#10;      &quot;key&quot;: &quot;baseUrl&quot;,&#10;      &quot;value&quot;: &quot;http://localhost:8080/AUTH-SERVICE&quot;&#10;    },&#10;    {&#10;      &quot;key&quot;: &quot;token&quot;,&#10;      &quot;value&quot;: &quot;your_jwt_token_here&quot;&#10;    }&#10;  ]&#10;}&#10;```&#10;&#10;---&#10;&#10;##  Exemples d'utilisation&#10;&#10;### JavaScript/Fetch&#10;```javascript&#10;const uploadProfileImage = async (userId, file) =&gt; {&#10;  const formData = new FormData();&#10;  formData.append('file', file);&#10;  &#10;  const response = await fetch(&#10;    `http://localhost:8080/AUTH-SERVICE/admin/users/${userId}/profile-image`,&#10;    {&#10;      method: 'POST',&#10;      headers: {&#10;        'Authorization': `Bearer ${token}`&#10;      },&#10;      body: formData&#10;    }&#10;  );&#10;  &#10;  return response.json();&#10;};&#10;```&#10;&#10;### Angular&#10;```typescript&#10;uploadProfileImage(userId: number, file: File): Observable&lt;User&gt; {&#10;  const formData = new FormData();&#10;  formData.append('file', file);&#10;  return this.http.post&lt;User&gt;(&#10;    `${this.API_URL}/admin/users/${userId}/profile-image`,&#10;    formData&#10;  );&#10;}&#10;```&#10;&#10;---&#10;&#10;##  Gestion des erreurs&#10;&#10;### Erreurs courantes&#10;&#10;**400 Bad Request**&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2024-12-01T10:30:00&quot;,&#10;  &quot;status&quot;: 400,&#10;  &quot;error&quot;: &quot;Bad Request&quot;,&#10;  &quot;message&quot;: &quot;Le nom du fichier est invalide&quot;&#10;}&#10;```&#10;&#10;**404 Not Found**&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2024-12-01T10:30:00&quot;,&#10;  &quot;status&quot;: 404,&#10;  &quot;error&quot;: &quot;Not Found&quot;,&#10;  &quot;message&quot;: &quot;Utilisateur non trouvé&quot;&#10;}&#10;```&#10;&#10;**500 Internal Server Error**&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2024-12-01T10:30:00&quot;,&#10;  &quot;status&quot;: 500,&#10;  &quot;error&quot;: &quot;Internal Server Error&quot;,&#10;  &quot;message&quot;: &quot;Impossible de stocker le fichier&quot;&#10;}&#10;```&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/IMAGE_UPLOAD_FEATURE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/IMAGE_UPLOAD_FEATURE.md" />
              <option name="updatedContent" value="# Fonctionnalité d'Upload d'Images de Profil&#10;&#10;## Vue d'ensemble&#10;&#10;Cette fonctionnalité permet aux administrateurs d'ajouter et de modifier des images de profil pour les utilisateurs via l'interface d'administration.&#10;&#10;## Composants&#10;&#10;### Backend (Spring Boot)&#10;&#10;#### 1. FileStorageService&#10;- **Localisation**: `auth-service/src/main/java/com/aitsaid/authservice/service/FileStorageService.java`&#10;- **Fonctions**:&#10;  - `storeFile()`: Stocke un fichier sur le disque avec un nom unique UUID&#10;  - `loadFile()`: Charge un fichier depuis le disque&#10;  - `deleteFile()`: Supprime un fichier&#10;&#10;#### 2. FileController&#10;- **Localisation**: `auth-service/src/main/java/com/aitsaid/authservice/controllers/FileController.java`&#10;- **Endpoints**:&#10;  - `POST /files/upload`: Upload un fichier&#10;  - `GET /files/{fileName}`: Récupère un fichier&#10;  - `DELETE /files/{fileName}`: Supprime un fichier&#10;&#10;#### 3. UserController&#10;- **Nouvel endpoint**:&#10;  - `POST /admin/users/{userId}/profile-image`: Upload l'image de profil d'un utilisateur&#10;&#10;#### 4. Configuration&#10;- **Fichier**: `application.yml`&#10;- **Propriétés**:&#10;  ```yaml&#10;  spring:&#10;    servlet:&#10;      multipart:&#10;        enabled: true&#10;        max-file-size: 10MB&#10;        max-request-size: 10MB&#10;  &#10;  file:&#10;    upload-dir: uploads/profile-images&#10;  ```&#10;&#10;### Frontend (Angular)&#10;&#10;#### 1. ImageUploadComponent&#10;- **Localisation**: `src/app/shared/components/image-upload/`&#10;- **Fonctionnalités**:&#10;  - Sélection de fichiers avec validation (type et taille)&#10;  - Prévisualisation de l'image avant upload&#10;  - Suppression de l'image&#10;  - Affichage du spinner pendant l'upload&#10;  - Support des images JPG, PNG, GIF (max 5MB)&#10;&#10;#### 2. UserFormComponent&#10;- **Mise à jour**: Intégration du composant ImageUpload&#10;- **Workflow**:&#10;  1. L'utilisateur sélectionne une image&#10;  2. Une prévisualisation s'affiche&#10;  3. Lors de la soumission du formulaire, l'utilisateur est créé/mis à jour&#10;  4. Si une image est sélectionnée, elle est uploadée ensuite&#10;  5. L'URL de l'image est sauvegardée dans la base de données&#10;&#10;#### 3. UserService&#10;- **Nouvelles méthodes**:&#10;  - `uploadProfileImage()`: Upload l'image de profil d'un utilisateur&#10;  - `uploadFile()`: Upload un fichier générique&#10;&#10;## Utilisation&#10;&#10;### Ajouter une image lors de la création d'un utilisateur&#10;&#10;1. Cliquer sur &quot;Nouvel Utilisateur&quot;&#10;2. Cliquer sur &quot;Ajouter une image&quot;&#10;3. Sélectionner une image (JPG, PNG, GIF - max 5MB)&#10;4. Remplir les autres champs du formulaire&#10;5. Cliquer sur &quot;Create&quot;&#10;&#10;### Modifier l'image d'un utilisateur existant&#10;&#10;1. Dans la liste des utilisateurs, cliquer sur les trois points verticaux&#10;2. Sélectionner &quot;Modifier&quot;&#10;3. Cliquer sur &quot;Changer l'image&quot;&#10;4. Sélectionner une nouvelle image&#10;5. Cliquer sur &quot;Update&quot;&#10;&#10;### Supprimer une image&#10;&#10;Dans le formulaire d'édition, cliquer sur le bouton &quot;X&quot; en haut à droite de l'image de prévisualisation.&#10;&#10;## Stockage des fichiers&#10;&#10;Les fichiers sont stockés dans le répertoire configuré (`uploads/profile-images` par défaut) avec un nom unique généré par UUID.&#10;&#10;**Structure**:&#10;```&#10;auth-service/&#10;  uploads/&#10;    profile-images/&#10;      550e8400-e29b-41d4-a716-446655440000.jpg&#10;      6ba7b810-9dad-11d1-80b4-00c04fd430c8.png&#10;```&#10;&#10;## Sécurité&#10;&#10;- Validation du type de fichier côté frontend et backend&#10;- Taille maximale: 5MB (frontend), 10MB (backend)&#10;- Noms de fichiers uniques (UUID) pour éviter les conflits&#10;- Vérification des caractères invalides dans les noms de fichiers&#10;&#10;## Structure de la base de données&#10;&#10;Le champ `profileImage` dans la table `users` stocke l'URL complète de l'image:&#10;```&#10;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&#10;```&#10;&#10;## API Endpoints&#10;&#10;### Upload d'image&#10;```http&#10;POST /AUTH-SERVICE/files/upload&#10;Content-Type: multipart/form-data&#10;&#10;Response:&#10;{&#10;  &quot;fileName&quot;: &quot;550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;fileUrl&quot;: &quot;/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;,&#10;  &quot;fileType&quot;: &quot;image/jpeg&quot;,&#10;  &quot;size&quot;: &quot;45678&quot;&#10;}&#10;```&#10;&#10;### Upload image de profil utilisateur&#10;```http&#10;POST /AUTH-SERVICE/admin/users/{userId}/profile-image&#10;Content-Type: multipart/form-data&#10;&#10;Response: UserDetails object with updated profileImage&#10;```&#10;&#10;### Récupérer une image&#10;```http&#10;GET /AUTH-SERVICE/files/{fileName}&#10;&#10;Response: Image file (binary)&#10;```&#10;&#10;## CORS&#10;&#10;Assurez-vous que la configuration CORS autorise les requêtes depuis le frontend Angular (`http://localhost:4200`).&#10;&#10;## Notes importantes&#10;&#10;1. Le répertoire `uploads/profile-images` doit avoir les permissions d'écriture&#10;2. En production, envisagez d'utiliser un service de stockage cloud (AWS S3, Azure Blob Storage, etc.)&#10;3. Implémentez une stratégie de backup pour les images uploadées&#10;4. Considérez l'ajout d'un CDN pour améliorer les performances&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/IMAGE_UPLOAD_SUMMARY.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/IMAGE_UPLOAD_SUMMARY.md" />
              <option name="updatedContent" value="# Récapitulatif - Fonctionnalité d'Upload d'Images de Profil&#10;&#10;##  Résumé&#10;&#10;J'ai créé une fonctionnalité complète d'upload d'images de profil pour votre application bancaire. Les utilisateurs peuvent maintenant avoir des photos de profil qui s'affichent dans la liste des utilisateurs.&#10;&#10;##  Fonctionnalités implémentées&#10;&#10;### Backend (Spring Boot)&#10;&#10;1. **Service de stockage de fichiers** (`FileStorageService.java`)&#10;   - Stockage des fichiers avec noms UUID uniques&#10;   - Gestion de la création du répertoire&#10;   - Méthodes pour charger et supprimer des fichiers&#10;&#10;2. **Contrôleur de fichiers** (`FileController.java`)&#10;   - `POST /files/upload` - Upload générique de fichiers&#10;   - `GET /files/{fileName}` - Récupération de fichiers&#10;   - `DELETE /files/{fileName}` - Suppression de fichiers&#10;&#10;3. **Mise à jour du UserService** &#10;   - Méthode `updateUserProfileImage()` pour associer une image à un utilisateur&#10;   - Suppression automatique de l'ancienne image lors du remplacement&#10;&#10;4. **Mise à jour du UserController**&#10;   - `POST /admin/users/{userId}/profile-image` - Upload d'image de profil&#10;&#10;5. **Configuration** (`application.yml`)&#10;   - Configuration multipart (max 10MB)&#10;   - Répertoire de stockage configurable&#10;&#10;### Frontend (Angular)&#10;&#10;1. **Composant réutilisable ImageUpload**&#10;   - Sélection de fichiers avec validation&#10;   - Prévisualisation de l'image avant upload&#10;   - Support drag &amp; drop visuel&#10;   - Affichage du spinner pendant l'upload&#10;   - Validation : types (JPG, PNG, GIF) et taille (max 5MB)&#10;&#10;2. **Intégration dans UserFormComponent**&#10;   - Section d'upload d'images au début du formulaire&#10;   - Workflow : créer/modifier utilisateur → upload image → mise à jour&#10;   - Gestion des messages de succès/erreur&#10;&#10;3. **Mise à jour du UserService**&#10;   - Méthodes `uploadProfileImage()` et `uploadFile()`&#10;&#10;4. **Affichage dans UserListComponent**&#10;   - Images de profil circulaires avec bordure orange (#F44E1E)&#10;   - Icône par défaut pour les utilisateurs sans image&#10;   - Images visibles dans la colonne &quot;Nom&quot;&#10;&#10;##  Fichiers créés&#10;&#10;### Backend&#10;```&#10;auth-service/src/main/java/com/aitsaid/authservice/&#10;├── service/&#10;│   └── FileStorageService.java          [NOUVEAU]&#10;└── controllers/&#10;    └── FileController.java               [NOUVEAU]&#10;```&#10;&#10;### Frontend&#10;```&#10;src/app/&#10;├── shared/&#10;│   └── components/&#10;│       └── image-upload/&#10;│           ├── image-upload.component.ts     [NOUVEAU]&#10;│           ├── image-upload.component.html   [NOUVEAU]&#10;│           └── image-upload.component.css    [NOUVEAU]&#10;└── services/&#10;    └── user.service.ts                   [MODIFIÉ]&#10;```&#10;&#10;### Documentation&#10;```&#10;├── IMAGE_UPLOAD_FEATURE.md               [NOUVEAU]&#10;└── IMAGE_UPLOAD_TEST_GUIDE.md            [NOUVEAU]&#10;```&#10;&#10;##  Fichiers modifiés&#10;&#10;### Backend&#10;- `UserService.java` - Ajout de la méthode updateUserProfileImage()&#10;- `UserController.java` - Ajout de l'endpoint pour upload d'image&#10;- `application.yml` - Configuration multipart et répertoire d'upload&#10;- `User.java` - Champ profileImage déjà présent (LONGTEXT)&#10;&#10;### Frontend&#10;- `user-form.component.ts` - Intégration du composant ImageUpload&#10;- `user-form.component.html` - Section d'upload ajoutée&#10;- `user-form.component.css` - Styles pour la section d'images&#10;- `user-list.component.html` - Affichage des images de profil&#10;- `user-list.component.css` - Style pour les avatars&#10;- `user.service.ts` - Méthodes d'upload ajoutées&#10;- `user.model.ts` - Interface User avec profileImage&#10;&#10;##  Comment utiliser&#10;&#10;### 1. Démarrer les services&#10;&#10;**Backend:**&#10;```bash&#10;cd intelligent_financial_assistant_backend/auth-service&#10;mvn spring-boot:run&#10;```&#10;&#10;**Frontend:**&#10;```bash&#10;cd intelligent_financial_assistant_frontend_web&#10;npm start&#10;```&#10;&#10;### 2. Créer un utilisateur avec image&#10;&#10;1. Aller sur http://localhost:4200/admin/users&#10;2. Cliquer sur &quot;Nouvel Utilisateur&quot;&#10;3. Cliquer sur &quot;Ajouter une image&quot;&#10;4. Sélectionner une image (JPG, PNG, GIF &lt; 5MB)&#10;5. Remplir les informations&#10;6. Cliquer sur &quot;Create&quot;&#10;&#10;### 3. Modifier l'image d'un utilisateur&#10;&#10;1. Cliquer sur les 3 points → &quot;Modifier&quot;&#10;2. Cliquer sur &quot;Changer l'image&quot;&#10;3. Sélectionner une nouvelle image&#10;4. Cliquer sur &quot;Update&quot;&#10;&#10;##  Configuration&#10;&#10;### Backend&#10;Le répertoire de stockage est configurable dans `application.yml` :&#10;```yaml&#10;file:&#10;  upload-dir: uploads/profile-images&#10;```&#10;&#10;Par défaut, les fichiers sont stockés dans :&#10;```&#10;auth-service/uploads/profile-images/&#10;```&#10;&#10;### Frontend&#10;Les limites sont définies dans `ImageUploadComponent` :&#10;- Types acceptés : image/jpg, image/jpeg, image/png, image/gif&#10;- Taille maximale : 5MB&#10;&#10;##  Personnalisation&#10;&#10;### Couleurs&#10;- Bordure des images : `#F44E1E` (orange, couleur du bouton &quot;Nouvel Utilisateur&quot;)&#10;- Icône par défaut : `#FFBD09` (jaune)&#10;&#10;### Taille des avatars&#10;Dans `user-list.component.css` :&#10;```css&#10;.user-avatar-img {&#10;  width: 40px;&#10;  height: 40px;&#10;  border-radius: 50%;&#10;}&#10;```&#10;&#10;##  Sécurité&#10;&#10;✅ Validation du type de fichier (frontend + backend)&#10;✅ Limite de taille (5MB frontend, 10MB backend)&#10;✅ Noms de fichiers UUID uniques&#10;✅ Authentification requise pour l'upload&#10;✅ Vérification des caractères invalides&#10;&#10;##  Structure de données&#10;&#10;### Base de données&#10;Le champ `profile_image` dans la table `users` stocke l'URL complète :&#10;```sql&#10;profile_image: &quot;http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg&quot;&#10;```&#10;&#10;### Stockage des fichiers&#10;```&#10;uploads/profile-images/&#10;├── 550e8400-e29b-41d4-a716-446655440000.jpg&#10;├── 6ba7b810-9dad-11d1-80b4-00c04fd430c8.png&#10;└── 7c9e6679-7425-40de-944b-e07fc1f90ae7.gif&#10;```&#10;&#10;##  Tests&#10;&#10;Consultez `IMAGE_UPLOAD_TEST_GUIDE.md` pour un guide complet de tests incluant :&#10;- Tests fonctionnels&#10;- Tests de validation&#10;- Tests API avec Postman&#10;- Problèmes courants et solutions&#10;&#10;##  Documentation&#10;&#10;- **IMAGE_UPLOAD_FEATURE.md** : Documentation technique détaillée&#10;- **IMAGE_UPLOAD_TEST_GUIDE.md** : Guide de test complet&#10;&#10;## ⚠️ Points d'attention&#10;&#10;1. **Permissions** : Assurez-vous que le répertoire `uploads/` a les permissions d'écriture&#10;&#10;2. **Production** : En production, envisagez :&#10;   - Utiliser un service cloud (AWS S3, Azure Blob)&#10;   - Implémenter un CDN&#10;   - Ajouter une compression d'images&#10;   - Mettre en place des backups&#10;&#10;3. **CORS** : Vérifiez que CORS autorise `http://localhost:4200`&#10;&#10;4. **Base de données** : Le champ `profile_image` est de type `LONGTEXT` dans l'entité User&#10;&#10;##  Résultat final&#10;&#10;- ✅ Upload d'images fonctionnel&#10;- ✅ Prévisualisation en temps réel&#10;- ✅ Affichage dans la liste des utilisateurs&#10;- ✅ Validation complète&#10;- ✅ Interface utilisateur intuitive&#10;- ✅ Messages de feedback appropriés&#10;- ✅ Gestion des erreurs&#10;- ✅ Documentation complète&#10;&#10;##  Prochaines améliorations possibles&#10;&#10;1. Compression automatique des images&#10;2. Recadrage/redimensionnement avant upload&#10;3. Support du drag &amp; drop&#10;4. Galerie d'avatars prédéfinis&#10;5. Historique des images de profil&#10;6. Génération de miniatures&#10;7. Migration vers un service cloud de stockage&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/IMAGE_UPLOAD_TEST_GUIDE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/IMAGE_UPLOAD_TEST_GUIDE.md" />
              <option name="updatedContent" value="# Guide de Test - Fonctionnalité d'Upload d'Images&#10;&#10;## Prérequis&#10;&#10;1. Backend Spring Boot en cours d'exécution (port 8081)&#10;2. Frontend Angular en cours d'exécution (port 4200)&#10;3. Base de données PostgreSQL accessible&#10;4. Un compte admin connecté&#10;&#10;## Tests à effectuer&#10;&#10;### Test 1: Upload d'image lors de la création d'un utilisateur&#10;&#10;1. **Accéder à la page de gestion des utilisateurs**&#10;   - URL: `http://localhost:4200/admin/users`&#10;&#10;2. **Créer un nouvel utilisateur avec image**&#10;   - Cliquer sur le bouton &quot;Nouvel Utilisateur&quot; (orange)&#10;   - Cliquer sur &quot;Ajouter une image&quot;&#10;   - Sélectionner une image de test (JPG, PNG ou GIF, &lt; 5MB)&#10;   - Vérifier que la prévisualisation s'affiche&#10;   - Remplir les champs:&#10;     - Prénom: Test&#10;     - Nom: Image&#10;     - Email: test.image@example.com&#10;     - Mot de passe: test123&#10;     - CIN: AB123456&#10;     - Téléphone: 0612345678&#10;     - Adresse: Test Address&#10;   - Cliquer sur &quot;Create&quot;&#10;   - **Résultat attendu**: Message de succès + utilisateur créé avec son image visible dans la liste&#10;&#10;### Test 2: Modification de l'image d'un utilisateur existant&#10;&#10;1. **Modifier un utilisateur**&#10;   - Dans la liste, cliquer sur les 3 points verticaux d'un utilisateur&#10;   - Sélectionner &quot;Modifier&quot;&#10;   - L'image actuelle devrait s'afficher (si elle existe)&#10;&#10;2. **Changer l'image**&#10;   - Cliquer sur &quot;Changer l'image&quot;&#10;   - Sélectionner une nouvelle image&#10;   - Vérifier que la nouvelle prévisualisation s'affiche&#10;   - Cliquer sur &quot;Update&quot;&#10;   - **Résultat attendu**: Message de succès + nouvelle image visible dans la liste&#10;&#10;### Test 3: Suppression d'image&#10;&#10;1. **Supprimer l'image d'un utilisateur**&#10;   - Modifier un utilisateur qui a une image&#10;   - Cliquer sur le bouton &quot;X&quot; en haut à droite de l'image&#10;   - La prévisualisation devrait disparaître&#10;   - Cliquer sur &quot;Update&quot;&#10;   - **Résultat attendu**: L'utilisateur n'a plus d'image (icône par défaut affichée)&#10;&#10;### Test 4: Validation des fichiers&#10;&#10;1. **Tester avec un fichier non-image**&#10;   - Essayer d'uploader un PDF ou un fichier texte&#10;   - **Résultat attendu**: Message d'erreur &quot;Veuillez sélectionner un fichier image valide&quot;&#10;&#10;2. **Tester avec une image trop grande**&#10;   - Essayer d'uploader une image &gt; 5MB&#10;   - **Résultat attendu**: Message d'erreur &quot;La taille de l'image ne doit pas dépasser 5MB&quot;&#10;&#10;### Test 5: Affichage dans la liste&#10;&#10;1. **Vérifier l'affichage des images**&#10;   - Accéder à la liste des utilisateurs&#10;   - Les utilisateurs avec images devraient afficher leur photo de profil (cercle avec bordure orange)&#10;   - Les utilisateurs sans image devraient afficher l'icône par défaut (account_circle jaune)&#10;&#10;### Test 6: Vérification backend&#10;&#10;1. **Vérifier les fichiers sur le disque**&#10;   - Naviguer vers `auth-service/uploads/profile-images/`&#10;   - Les images uploadées devraient être présentes avec des noms UUID&#10;   - Exemple: `550e8400-e29b-41d4-a716-446655440000.jpg`&#10;&#10;2. **Vérifier la base de données**&#10;   - Se connecter à PostgreSQL&#10;   - Exécuter: `SELECT id, first_name, last_name, profile_image FROM users;`&#10;   - Le champ `profile_image` devrait contenir l'URL complète&#10;   - Exemple: `http://localhost:8080/AUTH-SERVICE/files/550e8400-e29b-41d4-a716-446655440000.jpg`&#10;&#10;### Test 7: Accès direct aux images&#10;&#10;1. **Tester l'URL de l'image**&#10;   - Copier l'URL d'une image depuis la base de données&#10;   - Ouvrir l'URL dans un navigateur&#10;   - **Résultat attendu**: L'image s'affiche correctement&#10;&#10;## Tests API avec Postman&#10;&#10;### Upload d'un fichier&#10;```&#10;POST http://localhost:8080/AUTH-SERVICE/files/upload&#10;Headers:&#10;  Authorization: Bearer {token}&#10;Body (form-data):&#10;  file: [sélectionner un fichier]&#10;```&#10;&#10;### Upload d'image de profil utilisateur&#10;```&#10;POST http://localhost:8080/AUTH-SERVICE/admin/users/1/profile-image&#10;Headers:&#10;  Authorization: Bearer {token}&#10;Body (form-data):&#10;  file: [sélectionner un fichier]&#10;```&#10;&#10;### Récupérer une image&#10;```&#10;GET http://localhost:8080/AUTH-SERVICE/files/{fileName}&#10;Headers:&#10;  Authorization: Bearer {token}&#10;```&#10;&#10;## Problèmes courants et solutions&#10;&#10;### Problème 1: Erreur 403 lors de l'upload&#10;**Cause**: Problème d'authentification ou de CORS&#10;**Solution**: &#10;- Vérifier que le token JWT est valide&#10;- Vérifier la configuration CORS dans le backend&#10;&#10;### Problème 2: Image ne s'affiche pas&#10;**Cause**: URL incorrecte ou fichier supprimé&#10;**Solution**:&#10;- Vérifier que le fichier existe dans `uploads/profile-images/`&#10;- Vérifier l'URL dans la base de données&#10;- Vérifier que le endpoint `/files/{fileName}` est accessible&#10;&#10;### Problème 3: Répertoire uploads introuvable&#10;**Cause**: Le répertoire n'a pas été créé ou manque de permissions&#10;**Solution**:&#10;- Le service FileStorageService crée automatiquement le répertoire&#10;- Vérifier les permissions d'écriture&#10;&#10;### Problème 4: Upload lent&#10;**Cause**: Fichier trop volumineux&#10;**Solution**:&#10;- Optimiser/compresser l'image avant l'upload&#10;- Augmenter la limite de taille si nécessaire&#10;&#10;## Checklist de validation&#10;&#10;- [ ] Création d'utilisateur avec image fonctionne&#10;- [ ] Modification d'image fonctionne&#10;- [ ] Suppression d'image fonctionne&#10;- [ ] Validation des types de fichiers fonctionne&#10;- [ ] Validation de la taille fonctionne&#10;- [ ] Prévisualisation s'affiche correctement&#10;- [ ] Images s'affichent dans la liste&#10;- [ ] Spinner de chargement s'affiche pendant l'upload&#10;- [ ] Messages de succès/erreur s'affichent&#10;- [ ] Fichiers sont stockés sur le disque&#10;- [ ] URLs sont sauvegardées en base de données&#10;- [ ] Images sont accessibles via leur URL&#10;- [ ] Anciennes images sont supprimées lors du remplacement&#10;&#10;## Conseils pour les tests&#10;&#10;1. Utilisez des images de test de différentes tailles et formats&#10;2. Testez avec des noms de fichiers spéciaux (espaces, caractères spéciaux)&#10;3. Testez la création et modification rapide pour vérifier les race conditions&#10;4. Vérifiez les logs backend pour les erreurs potentielles&#10;5. Testez avec plusieurs utilisateurs simultanément&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>