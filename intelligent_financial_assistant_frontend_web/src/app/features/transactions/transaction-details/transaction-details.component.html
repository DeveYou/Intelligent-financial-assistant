<div class="container-fluid">
  <div class="page-header">
    <a mat-icon-button routerLink="/admin/transactions">
      <mat-icon>arrow_back</mat-icon>
    </a>
    <h1 class="page-title">Détails de la Transaction</h1>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des détails...</p>
  </div>

  <div *ngIf="error && !loading" class="error-message">
    <mat-icon>error</mat-icon>
    <span>{{ error }}</span>
    <button mat-button routerLink="/admin/transactions">Retour à la liste</button>
  </div>

  <mat-card *ngIf="transaction && !loading" class="details-card">
    <mat-card-header>
      <mat-card-title>Référence : {{ transaction.reference }}</mat-card-title>
      <mat-card-subtitle>
        <span class="badge" [ngClass]="{
          'badge-success': transaction.type === 'DEPOSIT',
          'badge-danger': transaction.type === 'WITHDRAWAL',
          'badge-info': transaction.type === 'TRANSFER'
        }">{{ getTypeLabel(transaction.type) }}</span>
        <span class="status-badge ml-2" [ngClass]="{
          'status-pending': transaction.status === 'PENDING',
          'status-completed': transaction.status === 'COMPLETED',
          'status-failed': transaction.status === 'FAILED',
          'status-cancelled': transaction.status === 'CANCELLED'
        }">{{ getStatusLabel(transaction.status) }}</span>
      </mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="details-grid">
        <!-- Montant -->
        <div class="detail-item">
          <span class="detail-label">Montant</span>
          <span class="detail-value amount-value" [ngClass]="{
            'amount-positive': transaction.type === 'DEPOSIT',
            'amount-negative': transaction.type === 'WITHDRAWAL' || transaction.type === 'TRANSFER'
          }">
            {{ transaction.amount | currency:'MAD':'symbol':'1.2-2' }}
          </span>
        </div>
        
        <!-- Date -->
        <div class="detail-item">
          <span class="detail-label">Date</span>
          <span class="detail-value">
            {{ formatDate(transaction.date) }}
          </span>
        </div>
        
        <!-- ID Utilisateur -->
        <div class="detail-item">
          <span class="detail-label">ID Utilisateur</span>
          <span class="detail-value">{{ transaction.userId || '-' }}</span>
        </div>
        
        <!-- Compte Bancaire -->
        <div class="detail-item">
          <span class="detail-label">{{ transaction.type === 'TRANSFER' ? 'Compte Source' : 'Compte Bancaire' }}</span>
          <span class="detail-value">{{ transaction.bankAccountId || '-' }}</span>
        </div>
        
        <!-- Statut -->
        <div class="detail-item">
          <span class="detail-label">Statut</span>
          <span class="detail-value">{{ getStatusLabel(transaction.status) }}</span>
        </div>
        
        <!-- Type -->
        <div class="detail-item">
          <span class="detail-label">Type</span>
          <span class="detail-value">{{ getTypeLabel(transaction.type) }}</span>
        </div>
        
        <!-- Destinataire (pour les transferts) -->
        <div *ngIf="transaction.type === 'TRANSFER'" class="detail-item">
          <span class="detail-label">Destinataire</span>
          <span class="detail-value">
            <div *ngIf="transaction.recipientId">ID: {{ transaction.recipientId }}</div>
            <div *ngIf="transaction.recipientIban">IBAN: {{ transaction.recipientIban }}</div>
            <div *ngIf="!transaction.recipientId && !transaction.recipientIban">-</div>
          </span>
        </div>
        
        <!-- Raison -->
        <div class="detail-item reason-item">
          <span class="detail-label">Raison / Description</span>
          <span class="detail-value reason-text">{{ transaction.reason || 'Non spécifiée' }}</span>
        </div>
        
        <!-- Actions -->
        <div class="detail-item action-item">
          <span class="detail-label">Actions</span>
          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="printDetails()">
              <mat-icon>print</mat-icon> Imprimer
            </button>
            <button *ngIf="transaction.status === 'PENDING'" 
                    mat-raised-button color="warn" 
                    (click)="cancelTransaction()">
              <mat-icon>cancel</mat-icon> Annuler
            </button>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>